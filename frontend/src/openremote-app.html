<html><head><link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="../bower_components/iron-swiper/iron-swiper.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-styles/color.html">

<link rel="import" href="../bower_components/paper-date-picker/paper-date-picker.html">

<link rel="import" href="openremote-login.html">
<link rel="import" href="openremote-intro.html">
<link rel="import" href="openremote-wizard.html">
<link rel="import" href="components/input-temperature.html">
<link rel="import" href="components/input-dropdown.html">
<link rel="import" href="components/input-switch-blok.html">
<link rel="import" href="components/table-schedule.html">
<link rel="import" href="components/table-schedule-edit.html">
<link rel="import" href="components/table-toggles.html">

</head><body><dom-module id="openremote-app">

  <template>
    <iron-ajax auto url="../../../api/settings/current/get_current_settings.json" on-response="handleResponse" handle-as="json"></iron-ajax>

    <style>
   
    </style>
      <app-location use-hash-as-path route="{{route}}"></app-location>
      <app-route
          route="{{route}}"
          pattern="/:view"
          data="{{routeData}}"
          tail="{{subroute}}">
      </app-route>

      <app-header-layout class="header-layout">
         <app-header id="header" effects="waterfall" fixed="">
          <app-toolbar class="app-toolbar-custom">
            <div main-title=""><img height="20px" style="margin-top:5px;" src="/images/blok61_logo.png"/></div>
            <a id="settings-btn" href="#/Settings">
              <paper-icon-button icon="settings"></paper-icon-button>
            </a>
          </app-toolbar>

          <paper-tabs selected="[[routeData.view]]" attr-for-selected="name" autoselect autoselect-delay="1000">
            <template is="dom-repeat" items="{{data.menu}}">
              <paper-tab name="{{item}}" link><a class="tab-link" href="#/{{item}}">{{item}}</a></paper-tab>
            </template>
          </paper-tabs>

        </app-header>
      </app-header-layout>
      <iron-pages id="pages"  selected="[[routeData.view]]" attr-for-selected="name" fallback-selection="Login">
          <div name="Login" class="page-overlay" route="{{subroute}}">
            <div class="page-overlay-inner">
              <app-toolbar class="app-toolbar-custom">
                <div main-title=""><img height="20px" style="margin-top:5px;" src="/images/blok61_logo.png"/></div>
              </app-toolbar>
               <div class="panel">
                <div class="inner-panel">
                  <openremote-login></openremote-login>
                 </div>
               </div>
            </div>
          </div>
           <div name="Intro" class="page-overlay" route="{{subroute}}">
            <div class="page-overlay-inner">
              <app-toolbar  class="app-toolbar-custom" style="z-index:99;position:relative;">
                <div main-title="">Introduction</div>
              </app-toolbar>
                  <openremote-intro  class="height-100"></openremote-intro>
            </div>
          </div>
          <div name="Wizard" class="page-overlay" route="{{subroute}}">
            <div class="page-overlay-inner">
              <app-toolbar  class="app-toolbar-custom">
                <paper-icon-button class="back-btn" icon="arrow-back" drawer-toggle=""></paper-icon-button>
                <div main-title="">Scene Wizard</div>
              </app-toolbar>
               <div class="panel transparent">
                  <openremote-wizard></openremote-wizard>
               </div>
            </div>
          </div>
          <div name="Home" route="{{subroute}}">
            <div class="panel">
              <div class="inner-panel">
                <div class="container no-margin">
                    <div class="container-column">
                      <iron-icon class="normal" src="../images/panel/star.png"></iron-icon>
                    </div>
                    <div class="container-column col_2">Full Smart</div>
                    <div class="container-column">
                        <paper-toggle-button data-target="smart.fullsmart" checked="[[checkStatus(data.current_scene.smart.fullsmart)]]" class="green"></paper-toggle-button>
                    </div>
                </div>
              </div>
            </div>
             <div class="panel">
              <div class="inner-panel">
                  <input-switch-blok active="{{data.current_scene.label}}"></input-switch-blok>
              </div>
            </div>
          </div>
          <div name="Light" route="{{subroute}}">
            <div class="panel">
              <div class="inner-panel">
                  <div class="container no-margin">
                    <div class="container-column">
                      <iron-icon class="normal" src="../images/panel/light_on.png"></iron-icon>
                    </div>
                    <div class="container-column col_2">Smart Lighting</div>
                    <div class="container-column">
                      <paper-toggle-button data-target="smart.light" checked="[[checkStatus(data.current_scene.smart.light)]]" class="green"></paper-toggle-button>
                    </div>
                </div>
              </div>
            </div>
             <div class="panel">
              <div class="inner-panel">
                <img style="width:100%;" src="../images/lighting.png"/>
              </div>
            </div>
          </div>
          <div name="Start" route="{{subroute}}">
            <div class="panel">
              <div class="inner-panel">
                <div class="container no-margin">
                    <div class="container-column">
                      <iron-icon class="normal" src="../images/panel/home_on.png"></iron-icon>
                    </div>
                    <div class="container-column col_2">Smart Start</div>
                    <div class="container-column">
                      <paper-toggle-button data-target="smart.start" checked="[[checkStatus(data.current_scene.smart.start)]]" class="green"></paper-toggle-button>
                    </div>
                </div>
              </div>
            </div>
            <div class="panel">
              <div class="inner-panel">
                 <template is="dom-repeat" index="i" items="{{data.current_scene.start_devices}}">
                      <div class="container no-margin-bottom">
                        <div class="container-column">
                          <iron-icon class="normal" src="../images/panel/home_on.png"></iron-icon>
                        </div>

                        <div class="container-column">
                          <span>{{item.label}}</span>
                        </div>
                         <div class="container-column"  style="margin-right: 10px; margin-left: auto;width:33px;height:33px; background-color:grey; font-size:11px;">
                          <span class="t-white" style="font-weight:100;line-height:normal;text-align:center;display: block;">Nu aan</span>
                        </div>
                        <div class="container-column" style="margin-left:0px;">
                            <input type="time" value="{{item.time}}">
                        </div>
                      </div>
                  </template>
              </div>
            </div>

            <div class="panel">
              <div class="inner-panel">
                 <div class="row background-image" style="background-image: url(../images/panel/energy_no_battery.png);">
                   <div class="container">
                    <div class="row">

                      <div class="container-column t-grey" style="margin-left:38px;position: absolute; margin-top: 52px;">
                        <div class="t-black">+12%</div>Green
                      </div>

                      <div class="container-column right t-grey">
                        <div class="row">
                         <div class="t-black"><span class="t-grey">Solar & Battery </span><span style="float:right;margin-right:0px;">{{data.current_scene.energy.solar}}kW</span></div> 
                        </div>
                        <div class="row" style="width:87%;height:5px; background-color:#c0d62e;">
                        </div>
                        <div class="row" style="width:17%;height:5px; background-color:grey;">
                        </div>
                        <div class="row">
                         <div class="t-black"><span class="t-grey">Main Power</span><span style="float:right;margin-right:0px;">{{data.current_scene.energy.usage}}kW</span></div> 
                        </div>
                    </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>

          <div name="Safety" route="{{subroute}}">
            <div class="panel">
              <div class="inner-panel">
                <div class="container no-margin">
                    <div class="container-column">
                      <iron-icon class="normal" src="../images/panel/alarm_large_off.png"></iron-icon>
                    </div>
                    <div class="container-column col_2">Smart Safety</div>
                    <div class="container-column">
                      <paper-toggle-button data-target="smart.safety" checked="[[checkStatus(data.current_scene.smart.safety)]]" class="green"></paper-toggle-button>
                    </div>
                </div>
              </div>
            </div>
            <div class="panel">
              <div class="inner-panel">
                <div class="container">
                    <div class="container-column">
                      <iron-icon class="large" src="../images/panel/alarm_large_off.png"></iron-icon>
                    </div>
                    <div class="container-column col_2" style="margin-top: 10px;" >Alarm <div class="t-grey">Activity</div></div>
                    <div class="container-column">
                      <paper-toggle-button data-target="alarm" style="margin-top: 28px;" checked="[[checkStatus(data.current_scene.alarm)]]" class="green center"></paper-toggle-button>
                    </div>
                </div>
                <div class="container">
                    <div class="container-column">
                      <iron-icon class="normal" src="../images/panel/alarm_small_eye.png"></iron-icon>
                    </div>
                    <div class="container-column col_2">Living Room</div>
                    <div class="container-column t-grey">Activity</div>
                </div>
                <div class="container">
                    <div class="container-column">
                      <iron-icon class="normal" src="../images/panel/alarm_small_eye.png"></iron-icon>
                    </div>
                    <div class="container-column col_2">Hallway</div>
                    <div class="container-column t-grey">No Activity</div>
                </div>
                <div class="container">
                    <div class="container-column">
                      <iron-icon class="normal" src="../images/panel/alarm_small_eye.png"></iron-icon>
                    </div>
                    <div class="container-column col_2">Bedroom</div>
                    <div class="container-column t-grey">No Activity</div>
                </div>
                <div class="container">
                    <div class="container-column">
                      <iron-icon class="normal" src="../images/panel/alarm_small_eye.png"></iron-icon>
                    </div>
                    <div class="container-column col_2">Bathroom</div>
                    <div class="container-column t-grey">No Activity</div>
                </div>
              </div>
            </div>
          </div>

          <div name="Climate" route="{{subroute}}">
            <div class="panel">
              <div class="inner-panel">
                <div class="container no-margin">
                    <div class="container-column">
                      <iron-icon class="normal temp-icon" src="../images/panel/temperature.png"></iron-icon>
                    </div>
                    <div class="container-column col_2">Smart Climate</div>
                    <div class="container-column">
                      <paper-toggle-button data-target="smart.climate" checked="[[checkStatus(data.current_scene.smart.climate)]]" class="green"></paper-toggle-button>
                    </div>
                </div>
              </div>
            </div>
             <div class="panel">
              <div class="inner-panel">
                <div class="container">
                  <div class="container-column">
                    <span style="display:block;">Living Room</span>
                    <span style="margin-top:20px;font-size:62px;display:block;" class="t-grey celsius">{{data.current_scene.temperature_actual.living_room}}</span>
                  </div>
                  <div class="container-column margin-left-auto">
                     <input-temperature size="large" data="{{temperatures}}" active="{{data.current_scene.temperature_program.living_room}}"></input-temperature>
                  </div>
                </div>
                <div class="container">
                    <div class="container-column">
                      <iron-icon class="small temp-icon" src="../images/panel/temperature.png"></iron-icon>
                    </div>
                    <div class="container-column">Bedroom</div>
                    <div class="container-column celsius margin-left-auto t-grey">{{data.current_scene.temperature_actual.bedroom}}</div>
                    <div class="container-column">
                       <input-temperature size="small" data="{{temperatures}}" active="{{data.current_scene.temperature_program.bedroom}}"></input-temperature>
                    </div>
                  </div>
                  <div class="container">
                    <div class="container-column">
                      <iron-icon class="small temp-icon" src="../images/panel/temperature.png"></iron-icon>
                    </div>
                    <div class="container-column">Bathroom</div>
                    <div class="container-column celsius margin-left-auto t-grey">{{data.current_scene.temperature_actual.bathroom}}</div>
                    <div class="container-column">
                       <input-temperature size="small" data="{{temperatures}}" active="{{data.current_scene.temperature_program.bathroom}}"></input-temperature>
                    </div>
                  </div>
              </div>
              </div>
            
            <div class="panel">
              <div class="inner-panel">
                  <div class="container">
                    <div class="container-column">
                      <iron-icon class="normal" src="../images/panel/ventilation.png"></iron-icon>
                    </div>
                    <div class="container-column col_2">Ventilation</div>
                    <div class="container-column">
                       <input-dropdown data="{{ventilation_options}}" active="{{data.current_scene.ventilation}}"></input-dropdown>
                    </div>
                  </div>
              </div>
            </div>
          </div>

          <div name="Settings" class="page-overlay" route="{{subroute}}">
            <div class="page-overlay-inner"> 
              <app-toolbar  class="app-toolbar-custom">
                <paper-icon-button class="back-btn" icon="arrow-back" drawer-toggle=""></paper-icon-button>
                <div main-title="">Settings</div>
                <a href="#/Login" on-click="logOut" class="right">Log out</a>
              </app-toolbar>
              <div class="panel">
                <div class="inner-panel-10">
                  <span class="center" on-click="toggleVacation">Vacation</span>
                  <iron-collapse id="collapseVacation">
                   <div class="container">
                    <div class="container-column col_2">On vacation until</div>
                    <div class="container-column col_2">
                      <input id="vacation_date" type="date" class="bg-darkgreen"/>
                    </div>
                     
                    </div>
                  </iron-collapse>
                </div>
              </div>
              <div class="panel">                
                <div class="inner-panel-10">
                  <span class="center"  on-click="toggleWeek">Presence schedule</span>
                  <iron-collapse id="collapseWeek">
                   <div class="container"><span>Self Learning</span><paper-toggle-button data-target="" style="margin-left:auto;" class="green"></paper-toggle-button></div>
                      
                    <table-schedule-edit data="{{data.predicted_schedule.data}}"  header="{{data.predicted_schedule.header}}"></table-schedule-edit>
                    <div class="row">
                      <div style="width: 178px; display: flex; margin-left: auto;" >
                        <paper-button class="paper-button-default" onclick="">CANCEL</paper-button>
                        <paper-button class="bg-darkgreen t-white paper-button-default" onclick="">SAVE</paper-button>
                      </div>
                    </div>
                  </iron-collapse>
                </div>
              </div>
              <div class="panel">
                <div class="inner-panel-10">
                  <span class="center"  on-click="toggleScenes">Scenes</span>
                  <iron-collapse id="collapseScenes">
                    <div class="row">
                      <table-schedule data="{{data.alarms.data}}"  header="{{data.alarms.header}}"></table-toggles>                  
                    </div>
                    <div class="row">
                      <table-schedule data="{{data.scenes.data}}"  header="{{data.scenes.header}}"></table-schedule>  
                    </div>
                    <div class="row">
                      <a href="#/Wizard"><paper-button style="margin:0;" class="full_width bg-darkgreen paper-button-default">Scene Wizard</paper-button></a>
                    </div>
                  </div>
                </iron-collapse>
              </div>
              <div class="panel" style="background-color:transparent;">
                <div class="inner-panel">
                  <p class="center" style="color:rgba(0,0,0,0.57);font-weight:100;font-size:13px;">Blok 61 - Appartement 235</p>
              </div>
            </div>
            </div>
          </div>
      </iron-pages>
      <paper-dialog id="dialog_date" class="paper-date-picker-dialog" with-backdrop
          on-iron-overlay-closed="dismissDialog">
          <paper-date-picker id="picker" date="[[date]]"></paper-date-picker>
          <div class="buttons">
            <paper-button class="paper-button-default t-black" dialog-dismiss>Cancel</paper-button>
            <paper-button class="paper-button-default bg-darkgreen t-white" dialog-confirm>SAVE</paper-button>
          </div>
        </paper-dialog>
        <paper-dialog id="scrolling">
          
          <table-schedule data="{{data.predicted_schedule.data}}"  header="{{data.predicted_schedule.header}}"></table-schedule>
          <div class="buttons">
            <paper-button dialog-dismiss>Cancel</paper-button>
            <paper-button dialog-confirm autofocus>OK</paper-button>
          </div>
        </paper-dialog>

        <paper-dialog id="actions" withBackdrop>
          <table-schedule-edit data="{{data.predicted_schedule.data}}" header="{{data.predicted_schedule.header}}"></table-schedule-edit>
          <div class="buttons">
            <paper-button class="paper-button-default" dialog-dismiss>Cancel</paper-button>
            <paper-button class="paper-button-default bg-darkgreen" dialog-confirm autofocus>SAVE</paper-button>
          </div>
        </paper-dialog>
  </template>

  <script>
    Polymer({
      ready: function() {
        var backFunction = function() {
            history.go(-1);
        }
        var backbtn = document.getElementsByClassName("back-btn");
        for (var i = 0; i < backbtn.length; i++) {
            backbtn[i].addEventListener('click', backFunction, false);
        }
       
        var toggle = document.querySelectorAll("paper-toggle-button");
        for (var i = 0; i < toggle.length; i++) {
            toggle[i].addEventListener('change', this.changeToggle, false);
        }

      },
      is: "openremote-app",
        properties: {
          data: Array,
          ventilation_options: Array,
          temperatures: Array,
          behaviors: [
            Polymer.IronOverlayBehavior,
          ],
        },
        dismissDialog: function(e,r){
          if(r.confirmed){
            var picker = document.getElementById("picker");
            console.log();
            var d = picker.date;

            var date_string = d.getFullYear().toString()+ '-'+ ("0" + (d.getMonth() + 1)).slice(-2)+'-'+ ("0" + d.getDate()).slice(-2);
            var dateInput = document.getElementById("vacation_date");
            dateInput.value = date_string;
          }
        },
        toggleVacation: function() {
           this.$.collapseVacation.toggle();
        },
        toggleWeek: function() {
           this.$.collapseWeek.toggle();
        },
        toggleScenes: function() {
           this.$.collapseScenes.toggle();
        },
        logOut: function(){
          localStorage.clear();
        },
        setValueToDict: function(value, stringPath){
          var path = stringPath.split(".");
          if(path.length == 1){
            self.data.current_scene[path[0]] = value;
          }else if(path.length == 2){;
            self.data.current_scene[path[0]][path[1]] = value;
          }else if(path.length == 3){;
            self.data.current_scene[path[0]][path[1]][path[2]] = value;
          }else if(path.length == 4){;
            self.data.current_scene[path[0]][path[1]][path[2]][path[4]] = value;
          }
        },
        changeToggle:function(event) {
          console.log(this.dataset.target);
          if (this.checked) {
            self.setValueToDict("true", this.dataset.target);
          } else {
            self.setValueToDict("false", this.dataset.target);
          }
        },
        checkStatus: function(status){
          if(status == "true"){
            var s = true;
          }else{
            var s = false;
          }
          return s;
        },
        handleResponse: function (data) {
            if (localStorage.jwt && localStorage.settings) {
              this.set('routeData.view', 'Home');
            }else if(localStorage.jwt){
              this.set('routeData.view', 'Intro');
            }else{
              this.set('routeData.view', 'Login');
            }
            this.temperatures = ["17.0","17.5","18.0","18.5","19.0","19.5","20.0","20.5","21.0","21.5","22.0","22.5","23.0","23.5","24.0","24.5","25.0"];
            this.ventilation_options = ['Auto', 'Low', 'Medium', 'High'];
            this.data = data.detail.response;
            self = this;
        }
    });
</script>

</dom-module></body></html>