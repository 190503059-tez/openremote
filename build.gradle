buildscript {
    repositories {
        jcenter()
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath "com.bmuschko:gradle-docker-plugin:$dockerGradlePluginVersion"
    }
}

allprojects {

    apply from: "${findProject(":openremote") != null ? project(":openremote").projectDir : rootDir}/functions.gradle"

    repositories {
        mavenLocal()
        mavenCentral()
        jcenter()
        maven {
            url "https://oss.sonatype.org/content/repositories/snapshots/"
        }
        maven {
            url "http://m2repo.openremote.com/content/groups/public/"
        }
    }

    version = projectVersion

    tasks.withType(JavaCompile) {
        sourceCompatibility = "1.8"
        // Don't even try to disable deprecation/unsafe warnings of javac, it will not work...
    }

    apply plugin: "com.bmuschko.docker-remote-api"

    docker {
        url = "$System.env.DOCKER_HOST".replace("tcp:", "https:")
        certPath = new File("$System.env.DOCKER_CERT_PATH")
        registryCredentials {
            username = project.properties.dockerHubUsername
            password = project.properties.dockerHubPassword
        }
    }

    ext.dockerImageName = "$dockerRepository/$project.name:$imageVersion".toLowerCase(Locale.ROOT)

    apply plugin: 'eclipse'
}
