apply plugin: "groovy"
apply plugin: 'cz.habarta.typescript-generator'

buildscript {
    repositories {
        mavenCentral()
        jcenter()
        maven {
            url "${resolveProject("").projectDir}/lib"
        }
    }
    dependencies {
        classpath 'cz.habarta.typescript-generator:typescript-generator-gradle-plugin:2.8.454-vyeeyowa'
        //classpath 'cz.habarta.typescript-generator:typescript-generator-gradle-plugin:2.8.449'
    }
}

repositories {
    maven {
        url "${resolveProject("").projectDir}/lib"
    }
}

dependencies {
    compile resolveProject(":model")
    compile 'cz.habarta.typescript-generator:typescript-generator-core:2.8.454-vyeeyowa'
//    compile 'cz.habarta.typescript-generator:typescript-generator-core:2.8.449'
}

generateTypeScript {
    jsonLibrary = "jackson2"
    classPatterns = [
            "org.openremote.model.**Resource"
    ]
    customTypeMappings = [
            "org.openremote.model.value.ObjectValue:object",
            "org.openremote.model.value.ArrayValue:Array<any>",
            "org.openremote.model.value.NumberValue:number",
            "org.openremote.model.value.StringValue:string",
            "org.openremote.model.value.BooleanValue:boolean",
            "org.openremote.model.value.Value:any"
    ]
    outputFile = "dist/restclient.ts"
    outputFileType = "implementationFile"
    outputKind = "module"
    mapEnum = cz.habarta.typescript.generator.EnumMapping.asEnum
    jaxrsNamespacing = "perResource"
    customTypeProcessor = "JaxRsClientOnlyProcessor"
    importDeclarations = [
            "import \"@openremote/model\""
    ]
    extensionClasses = [
            "AggregatedApiClient"
    ]
    extensions = [
            "cz.habarta.typescript.generator.ext.AxiosClientExtension"
    ]
}

//task clean {
//    doLast {
//        delete "build"
//    }
//}

task installDist {
    dependsOn generateTypeScript
}